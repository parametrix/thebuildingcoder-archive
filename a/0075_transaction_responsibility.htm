<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Building Coder</title>
    <link rel="stylesheet" href="bc.css">
    <link rel="stylesheet" href="google-code-prettify/prettify.css">
    <script src="google-code-prettify/run_prettify.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        a { color: #0066cc; }
        img { max-width: 100%; height: auto; }
        .nav { margin-bottom: 20px; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .nav a { margin-right: 15px; }
    </style>
  <link rel="stylesheet" href="toc/toc-sidebar.css">
</head>
<body>
    <div class="nav">
        <a href="index.html">← Back to Index</a>
    </div>
    <article>
<style>
.blue { color: blue; }
.teal { color: teal; }
.maroon { color: maroon; }
.green { color: green; }
</style>

<h3>Transaction Responsibility</h3>

<p>The last post on

<a href="0073_transaction.htm">
transactions</a>

explained the need to open a transaction of our own before trying to modify a document during an event.
That is actually not all.
We also need to remember that starting a transaction is not permitted at all times, and also that starting a new transaction or ending one may fail.
This leaves us with a certain amount of responsibility.
Therefore, we should add some error handling to ensure that failures are handled gracefully.
The sample should be amended like this:</p>

<pre class="code">
<span class="blue">void</span> application_OnDocumentNewed( <span class="teal">Document</span> doc )
{
&nbsp; <span class="green">// we cannot modify the document </span>
&nbsp; <span class="green">// unless a transaction is started</span>
&nbsp;
&nbsp; <span class="blue">if</span>( doc.BeginTransaction() )
&nbsp; {
&nbsp; &nbsp; <span class="green">// once a new transaction is started</span>
&nbsp; &nbsp; <span class="green">// we are responsible for ending or </span>
&nbsp; &nbsp; <span class="green">// aborting it, so we have to put </span>
&nbsp; &nbsp; <span class="green">// everything in a try-catch block</span>
&nbsp;
&nbsp; &nbsp; <span class="blue">try</span>
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; CreateUserDefinedParameters( doc );
&nbsp;
&nbsp; &nbsp; &nbsp; <span class="green">// we are responsible for ending </span>
&nbsp; &nbsp; &nbsp; <span class="green">// the transaction we started</span>
&nbsp;
&nbsp; &nbsp; &nbsp; doc.EndTransaction();
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="blue">catch</span>( <span class="teal">Exception</span> )
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; <span class="green">// if we cannot finish what we wanted</span>
&nbsp; &nbsp; &nbsp; <span class="green">// we should probably abort the whole thing</span>
&nbsp;
&nbsp; &nbsp; &nbsp; doc.AbortTransaction();
&nbsp; &nbsp; &nbsp; <span class="blue">throw</span>; <span class="green">// re-throw the exception</span>
&nbsp; &nbsp; }
&nbsp; }
}
</pre>

<p>Thank you to Arnost Lobel and Harry Mattison for providing this feedback!</p>

<p>I have arrived in Perugia by now ... rather slow progress, but getting there.</p>

    </article>
    <div class="nav">
        <a href="index.html">← Back to Index</a>
    </div>
<script src="toc/toc-sidebar.js"></script>
<script src="toc/copy-code.js"></script>
</body>
</html>
