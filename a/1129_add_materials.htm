<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Building Coder</title>
    <link rel="stylesheet" href="bc.css">
    <link rel="stylesheet" href="google-code-prettify/prettify.css">
    <script src="google-code-prettify/run_prettify.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        a { color: #0066cc; }
        img { max-width: 100%; height: auto; }
        .nav { margin-bottom: 20px; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .nav a { margin-right: 15px; }
    </style>
  <link rel="stylesheet" href="toc/toc-sidebar.css">
</head>
<body>
    <div class="nav">
        <a href="index.html">← Back to Index</a>
    </div>
    <article>
<head>
<link rel="stylesheet" type="text/css" href="bc.css">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="toc/toc-sidebar.css">
</head>

<!--

Игнатович Александр Сергеевич 

RE: adding new materials from list futher enhancement

-->

<h3>Getting Serious Adding New Materials from List</h3>

<p>Here is a post on some serious usability enhancements for the AddMaterials add-in, which reads a list of material properties from an Excel spreadsheet and generates Revit material elements accordingly.</p>

<p>It was originally presented for

<a href="0431_add_materials.htm#2">
Revit 2011</a>,

<a href="1116_add_materials.htm">
reimplemented for Revit 2014</a>,

and enhanced with

<a href="1122_add_materials.htm">
improved error messages and reporting</a> soon

after.</p>

<p>Until now, it was more of a programming example than an actual usable tool, but that is starting to change, thanks to a number of enhancements by Alexander Ignatovich, last but least the

<a href="1127_fill_pattern_wpf.htm">
WPF FillPattern viewer control</a> presented

last week.
Says Alex:</p>

<blockquote>

<p>I want to further enhance the tool for

<a href="1122_add_materials.htm">
adding new materials from a list</a>.</p>

<p>First of all, I split off the XLS data reading from the materials creation.
I also noticed that we cannot create a new material if the copy source base material does not exist in project, i.e. there if is no material with the name provided in 11 column.
Another problem I noticed occurs if I try to run the add-in command several times: in this case, it tries to repeatedly generate materials with the same name, and the LINQ ToDictionary method fails.
So, we must avoid such situations.</p>

<p>Summarizing: let's read data, mark the materials with no base class provided, or base class not found, and existing materials as "non-loadable", show the materials list to the user, where he (or she) can deselect some items and create the resulting materials list.</p>

<p>And one other, I think, the most valuable thing: in the materials import dialogue I added

<a href="1127_fill_pattern_wpf.htm">
surface and cut pattern preview controls</a> (see View\Controls\FillPatternViewerControlWpf.xaml).

This code is based on work performed by Victor Chekalin when he was working in our company.</p>

<p>I hope this code sample will be helpful.
Sorry, maybe some things are not accurate.
For example, Visual Studio does not show the design view of the MaterialsView form, because my MaterialViewModel.SurfacePattern and MaterialViewModel.CutPattern classes are really Autodesk.Revit.DB.FillPattern, but it is just an example :-)</p>

</blockquote>

<p>Thank you very much, and thanks to Victor as well for the nice fill pattern viewer.</p>

<p>That is a powerful tool and sample in its own right.</p>

<p>Here are screen snapshots of the AddMaterials add-in in action running.
In the first run, none of the CSI copy source base materials have been defined in the current project, so no new materials can be added:</p>

<center>
<img src="img/add_materials_ai_zero.png" alt="Material list with zero source materials defined" width="400"/>
</center>

<p>In the second run, I manually added one CSI material to copy from, and now one material can be added:</p>

<center>
<img src="img/add_materials_ai_one.png" alt="Material list with one source material defined" width="400"/>
</center>

<p>If this project is of further interest, another enhancement might be to remove the COM references to Microsoft office, to allow the command to work on computers without Microsoft Office installed.</p>

<p>Once again, many thanks to Victor and Alex for these valuable enhancements!</p>

<p>The complete source code, Visual Studio solution and add-in manifest is provided in the

<a href="https://github.com/jeremytammik/AddMaterials">AddMaterials GitHub repository</a>.</p>

<p>The version discussed above is

<a href="https://github.com/jeremytammik/AddMaterials/releases/tag/2014.0.0.1">
release 2014.0.0.2</a>.</p>

<p>Please feel free to fork that and add your own enhancements as well.</p>

<p>Good luck!</p>

    </article>
    <div class="nav">
        <a href="index.html">← Back to Index</a>
    </div>
<script src="toc/toc-sidebar.js"></script>
</body>
</html>
